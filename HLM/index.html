<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.306">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Israel Arevalo">
<meta name="dcterms.date" content="2023-05-04">

<title>Introduction to Hierarchical Linear Models / Mixed Effects Models in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Hierarchical Linear Models / Mixed Effects Models in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Israel Arevalo </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="before-we-start" class="level2">
<h2 class="anchored" data-anchor-id="before-we-start">Before we start</h2>
<p>You can find this guide and more on my <a href="https://github.com/israelarevalo/R-simple-statistics-tutorials">github page</a>.</p>
<p>This guide was designed as a friendly approach to learn how to conduct statistical analysis within the R environment. R is a powerful open-source tool that allows for great flexibility and customization of when conducting data wrangling (cleaning), analysis, interpretation, and reporting. Did I mention its open-source? This not only means that it is free, but the entire code used to develop this exceptional language is entirely available for you to view (and even suggest changes) online.</p>
<p>Several assumptions about the user will be made within this guide.</p>
<ol type="1">
<li>You have installed R and an IDE such as RStudio or Visual Studio Code on your computer</li>
<li>You have a dataset to work with</li>
</ol>
<p>If these assumptions are not met, here are a few guides to reference that will get you up to speed</p>
<ul>
<li><a href="https://rstudio-education.github.io/hopr/starting.html">Installing RStudio</a></li>
<li><a href="https://www.ibm.com/docs/en/spss-statistics/beta?topic=files-exporting-datasets">Exporting SPSS dataset to .CSV</a></li>
<li><a href="https://stats.oarc.ucla.edu/stata/faq/how-do-i-export-stata-dta-files-to-comma-separated-files/">Exporting STATA dataset to .csv</a></li>
<li><a href="https://support.microsoft.com/en-us/office/import-or-export-text-txt-or-csv-files-5250ac4c-663c-47ce-937b-339e391393ba">Exporting Excel file to .csv</a></li>
</ul>
</section>
<section id="mixed-effects-models---what-are-they-and-how-can-we-use-them" class="level2">
<h2 class="anchored" data-anchor-id="mixed-effects-models---what-are-they-and-how-can-we-use-them">Mixed Effects Models - What are they and how can we use them?</h2>
<p>In educational research, it is common to collect data from multiple participants or classrooms. These data often exhibit nested or hierarchical structures, where individuals are nested within higher-level units (e.g., students within classrooms, classrooms within schools). In such cases, traditional statistical models assume independence of observations, which may lead to biased estimates of the parameters.</p>
<p>Mixed effects models, also known as hierarchical linear models (HLM), are statistical models that take into account the nested structure of the data and allow for the estimation of both fixed and random effects. Fixed effects are the parameters of interest that are assumed to be constant across all the individuals or units, while random effects capture the variability across individuals or units.</p>
<p>Using mixed effects models can improve the accuracy of the estimates, increase statistical power, and provide a more comprehensive understanding of the underlying processes in educational research. In this tutorial, we will use the R programming language to illustrate the basics of mixed effects modeling. We will use the <code>lme4</code> package, which is one of the most popular packages for fitting mixed effects models in R.</p>
</section>
<section id="generating-our-dataset" class="level2">
<h2 class="anchored" data-anchor-id="generating-our-dataset">Generating our Dataset</h2>
<p>Using randomly-generated data, let’s build a fictitious dataset to math the scenario above and that we will use to run our HLM Model.</p>
<p>This step is only required for the instructional nature of this tutorial. You will <strong>not</strong> need to run this step as you do not need to randomly generate your data. Unless you do… in which case, have at it!</p>
<p>In the code block below, we will generate a dataframe consisting of math scores from students nested within classrooms who received an intervention of some kind and their respective SES. The purpose of this example is to determine whether the intervention had an effect on math scores, while controlling for SES, and taking into account the nested structure of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>n_classrooms <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>n_students <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>math_score_ctrl <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_classrooms<span class="sc">*</span>n_students, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>math_score_trt <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_classrooms<span class="sc">*</span>n_students, <span class="at">mean =</span> <span class="dv">55</span>, <span class="at">sd =</span> <span class="dv">7</span>) <span class="co"># higher mean and smaller SD</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>math_score <span class="ot">&lt;-</span> <span class="fu">c</span>(math_score_ctrl, math_score_trt)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>ses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(n_classrooms<span class="sc">*</span>n_students, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>intervention <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">each =</span> n_classrooms<span class="sc">*</span>n_students<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>classroom_id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_classrooms, <span class="at">each =</span> n_students<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>student_id <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>(n_students<span class="sc">*</span><span class="dv">2</span>), <span class="at">times =</span> n_classrooms)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(math_score, intervention, classroom_id, student_id, ses)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show first few rows</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  math_score intervention classroom_id student_id      ses
1   44.39524            0            1          1 42.11378
2   47.69823            0            1          2 44.97801
3   65.58708            0            1          3 64.96061
4   50.70508            0            1          4 38.62696
5   51.29288            0            1          5 48.20948
6   67.15065            0            1          6 69.02362</code></pre>
</div>
</div>
</section>
<section id="exploring-our-data" class="level2">
<h2 class="anchored" data-anchor-id="exploring-our-data">Exploring our Data</h2>
<p>Let’s take a look at simple descriptive statisitcs within our data. Running the base (summary) command allows us to look at information such as the minimum, maximum, quartiles, median, and means for each variable within our dataset. You can further customize this command by adding further adjustments to the command itself. For example, if we want to run5 a summary command on just 1 or 2 variables within a dataset containing many other variables, we can adjust our code to specify which variables we are interested in by adding a <code>$</code> symbol after the name of the dataset and then specifying the name of the variable (i.e., <code>summary(df$intervention</code>). Below we have run a simple <code>summary</code> command to explore our generated dataset. Since we only generated two variables, we do not need to specify which variables we are interested in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   math_score     intervention  classroom_id     student_id         ses       
 Min.   :26.91   Min.   :0.0   Min.   : 1.00   Min.   : 1.00   Min.   :25.34  
 1st Qu.:46.89   1st Qu.:0.0   1st Qu.: 3.75   1st Qu.: 5.75   1st Qu.:44.67  
 Median :52.27   Median :0.5   Median : 6.50   Median :10.50   Median :50.61  
 Mean   :52.49   Mean   :0.5   Mean   : 6.50   Mean   :10.50   Mean   :50.86  
 3rd Qu.:57.83   3rd Qu.:1.0   3rd Qu.: 9.25   3rd Qu.:15.25   3rd Qu.:58.46  
 Max.   :77.69   Max.   :1.0   Max.   :12.00   Max.   :20.00   Max.   :75.71  </code></pre>
</div>
</div>
<p>Some summary information may not be necessarily useful (e.g., classroom_id and student_id). When analyzing nested data, we can leverage the <code>dplyr</code> package to group students by classroom and then calculate descriptive data. The <code>dplyr</code> package is a powerful tool that allows us to conduct data wrangling (cleaning) and analysis. In the code block below, we will use the <code>dplyr</code> package to group our students by classroom and then calculate the number of students per classroom and the mean and standard deviation of their math scores. Additionally, we will use the <code>describeBy</code> function from the <code>psych</code> package to calculate descriptive statistics for each intervention group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load dplyr and psych package</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Group students by classroom and calculate the number of students per classroom</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(classroom_id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   classroom_id     n
          &lt;int&gt; &lt;int&gt;
 1            1    20
 2            2    20
 3            3    20
 4            4    20
 5            5    20
 6            6    20
 7            7    20
 8            8    20
 9            9    20
10           10    20
11           11    20
12           12    20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group students by classroom and calculate mean and standard deviation</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(classroom_id) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(math_score), <span class="at">sd =</span> <span class="fu">sd</span>(math_score)) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   classroom_id  mean    sd
          &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1            1  51.4  9.73
 2            2  49.5  8.30
 3            3  51.1  9.57
 4            4  48.8  9.73
 5            5  53.8  8.29
 6            6  46.4  7.01
 7            7  54.7  7.60
 8            8  53.8  7.22
 9            9  56.2  7.51
10           10  54.1  6.38
11           11  55.4  7.27
12           12  54.7  5.74</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">describeBy</span>(<span class="at">group =</span> <span class="st">"classroom_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Descriptive statistics by group 
classroom_id: 1
             vars  n  mean   sd median trimmed  mad   min   max range  skew
math_score      1 20 51.42 9.73  51.20   51.60 8.70 30.33 67.87 37.54 -0.06
intervention    2 20  0.00 0.00   0.00    0.00 0.00  0.00  0.00  0.00   NaN
classroom_id    3 20  1.00 0.00   1.00    1.00 0.00  1.00  1.00  0.00   NaN
student_id      4 20 10.50 5.92  10.50   10.50 7.41  1.00 20.00 19.00  0.00
ses             5 20 49.77 9.64  48.54   49.33 8.53 34.67 69.02 34.35  0.47
             kurtosis   se
math_score      -0.55 2.17
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.78 2.16
------------------------------------------------------------ 
classroom_id: 2
             vars  n  mean   sd median trimmed   mad   min   max range  skew
math_score      1 20 49.49 8.30  48.60   49.78 11.29 33.13 62.54 29.41 -0.19
intervention    2 20  0.00 0.00   0.00    0.00  0.00  0.00  0.00  0.00   NaN
classroom_id    3 20  2.00 0.00   2.00    2.00  0.00  2.00  2.00  0.00   NaN
student_id      4 20 10.50 5.92  10.50   10.50  7.41  1.00 20.00 19.00  0.00
ses             5 20 52.09 9.58  50.82   52.19  8.70 32.43 72.93 40.50  0.04
             kurtosis   se
math_score      -1.21 1.86
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.23 2.14
------------------------------------------------------------ 
classroom_id: 3
             vars  n  mean   sd median trimmed  mad   min   max range  skew
math_score      1 20 51.06 9.57  49.64   50.79 7.79 34.51 71.69 37.18  0.31
intervention    2 20  0.00 0.00   0.00    0.00 0.00  0.00  0.00  0.00   NaN
classroom_id    3 20  3.00 0.00   3.00    3.00 0.00  3.00  3.00  0.00   NaN
student_id      4 20 10.50 5.92  10.50   10.50 7.41  1.00 20.00 19.00  0.00
ses             5 20 53.95 9.81  51.95   54.40 9.74 33.33 70.02 36.70 -0.24
             kurtosis   se
math_score      -0.60 2.14
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.63 2.19
------------------------------------------------------------ 
classroom_id: 4
             vars  n  mean    sd median trimmed   mad   min   max range skew
math_score      1 20 48.80  9.73  47.88   48.78  8.20 26.91 70.50 43.59 0.04
intervention    2 20  1.00  0.00   1.00    1.00  0.00  1.00  1.00  0.00  NaN
classroom_id    3 20  4.00  0.00   4.00    4.00  0.00  4.00  4.00  0.00  NaN
student_id      4 20 10.50  5.92  10.50   10.50  7.41  1.00 20.00 19.00 0.00
ses             5 20 49.61 11.38  47.71   49.52 13.02 29.86 70.38 40.52 0.11
             kurtosis   se
math_score      -0.04 2.18
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -1.13 2.54
------------------------------------------------------------ 
classroom_id: 5
             vars  n  mean   sd median trimmed   mad   min   max range  skew
math_score      1 20 53.75 8.29  53.59   53.40  9.78 39.74 71.87 32.14  0.32
intervention    2 20  1.00 0.00   1.00    1.00  0.00  1.00  1.00  0.00   NaN
classroom_id    3 20  5.00 0.00   5.00    5.00  0.00  5.00  5.00  0.00   NaN
student_id      4 20 10.50 5.92  10.50   10.50  7.41  1.00 20.00 19.00  0.00
ses             5 20 50.50 9.98  51.22   50.98 10.29 29.48 65.19 35.71 -0.42
             kurtosis   se
math_score      -0.79 1.85
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.93 2.23
------------------------------------------------------------ 
classroom_id: 6
             vars  n  mean    sd median trimmed  mad   min   max range  skew
math_score      1 20 46.41  7.01  46.36   46.61 7.08 33.32 59.19 25.87 -0.09
intervention    2 20  1.00  0.00   1.00    1.00 0.00  1.00  1.00  0.00   NaN
classroom_id    3 20  6.00  0.00   6.00    6.00 0.00  6.00  6.00  0.00   NaN
student_id      4 20 10.50  5.92  10.50   10.50 7.41  1.00 20.00 19.00  0.00
ses             5 20 49.26 12.00  50.11   49.21 8.87 25.34 75.71 50.37  0.00
             kurtosis   se
math_score      -0.84 1.57
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.19 2.68
------------------------------------------------------------ 
classroom_id: 7
             vars  n  mean   sd median trimmed  mad   min   max range skew
math_score      1 20 54.73 7.60  54.89   54.56 7.22 40.63 68.36 27.74 0.15
intervention    2 20  0.00 0.00   0.00    0.00 0.00  0.00  0.00  0.00  NaN
classroom_id    3 20  7.00 0.00   7.00    7.00 0.00  7.00  7.00  0.00  NaN
student_id      4 20 10.50 5.92  10.50   10.50 7.41  1.00 20.00 19.00 0.00
ses             5 20 49.77 9.64  48.54   49.33 8.53 34.67 69.02 34.35 0.47
             kurtosis   se
math_score      -0.83 1.70
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.78 2.16
------------------------------------------------------------ 
classroom_id: 8
             vars  n  mean   sd median trimmed   mad   min   max range skew
math_score      1 20 53.79 7.22  53.10   53.53 10.03 43.79 69.70 25.91 0.21
intervention    2 20  0.00 0.00   0.00    0.00  0.00  0.00  0.00  0.00  NaN
classroom_id    3 20  8.00 0.00   8.00    8.00  0.00  8.00  8.00  0.00  NaN
student_id      4 20 10.50 5.92  10.50   10.50  7.41  1.00 20.00 19.00 0.00
ses             5 20 52.09 9.58  50.82   52.19  8.70 32.43 72.93 40.50 0.04
             kurtosis   se
math_score      -0.90 1.62
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.23 2.14
------------------------------------------------------------ 
classroom_id: 9
             vars  n  mean   sd median trimmed  mad   min   max range  skew
math_score      1 20 56.17 7.51  55.36   55.14 5.08 46.18 77.69 31.51  1.18
intervention    2 20  0.00 0.00   0.00    0.00 0.00  0.00  0.00  0.00   NaN
classroom_id    3 20  9.00 0.00   9.00    9.00 0.00  9.00  9.00  0.00   NaN
student_id      4 20 10.50 5.92  10.50   10.50 7.41  1.00 20.00 19.00  0.00
ses             5 20 53.95 9.81  51.95   54.40 9.74 33.33 70.02 36.70 -0.24
             kurtosis   se
math_score       1.33 1.68
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.63 2.19
------------------------------------------------------------ 
classroom_id: 10
             vars  n  mean    sd median trimmed   mad   min   max range skew
math_score      1 20 54.07  6.38  53.04   53.53  6.23 45.82 68.98 23.16 0.63
intervention    2 20  1.00  0.00   1.00    1.00  0.00  1.00  1.00  0.00  NaN
classroom_id    3 20 10.00  0.00  10.00   10.00  0.00 10.00 10.00  0.00  NaN
student_id      4 20 10.50  5.92  10.50   10.50  7.41  1.00 20.00 19.00 0.00
ses             5 20 49.61 11.38  47.71   49.52 13.02 29.86 70.38 40.52 0.11
             kurtosis   se
math_score      -0.54 1.43
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -1.13 2.54
------------------------------------------------------------ 
classroom_id: 11
             vars  n  mean   sd median trimmed   mad   min   max range  skew
math_score      1 20 55.42 7.27  52.62   54.93  5.41 46.01 70.39 24.38  0.62
intervention    2 20  1.00 0.00   1.00    1.00  0.00  1.00  1.00  0.00   NaN
classroom_id    3 20 11.00 0.00  11.00   11.00  0.00 11.00 11.00  0.00   NaN
student_id      4 20 10.50 5.92  10.50   10.50  7.41  1.00 20.00 19.00  0.00
ses             5 20 50.50 9.98  51.22   50.98 10.29 29.48 65.19 35.71 -0.42
             kurtosis   se
math_score      -0.97 1.63
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.93 2.23
------------------------------------------------------------ 
classroom_id: 12
             vars  n  mean    sd median trimmed  mad   min   max range skew
math_score      1 20 54.73  5.74  54.04   54.34 5.96 45.78 68.69 22.91 0.58
intervention    2 20  1.00  0.00   1.00    1.00 0.00  1.00  1.00  0.00  NaN
classroom_id    3 20 12.00  0.00  12.00   12.00 0.00 12.00 12.00  0.00  NaN
student_id      4 20 10.50  5.92  10.50   10.50 7.41  1.00 20.00 19.00 0.00
ses             5 20 49.26 12.00  50.11   49.21 8.87 25.34 75.71 50.37 0.00
             kurtosis   se
math_score      -0.40 1.28
intervention      NaN 0.00
classroom_id      NaN 0.00
student_id      -1.38 1.32
ses             -0.19 2.68</code></pre>
</div>
</div>
<p>Great! It looks like we have 10 students per classroom and their mean math scores range between 45 and 55. Also, thanks to the <code>psych</code> package, we get detailed group-level descriptive statistics for each classroom.</p>
<p>Let’s visualize this information using a histogram. To do this, we can use the <code>ggplot2</code> package. This package allows us to create beautiful and informative data visualizations. In the code block below, we will use the <code>ggplot2</code> package to create a histogram of our math scores. Also, let’s bring in the <code>facet_wrap</code> function to create a histogram for each intervention group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load ggplot2 package</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> math_score)) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>intervention)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This histogram shows us that the math scores for both intervention groups are normally distributed. However, the mean math score for the intervention group is slightly higher than the control group.</p>
</section>
<section id="centering-our-data" class="level2">
<h2 class="anchored" data-anchor-id="centering-our-data">Centering our Data</h2>
<p>According to best practices, we want to mean and grand mean center our data before running our mixed effects model. This is because centering our data allows us to interpret the intercept as the mean of the outcome variable when all predictors are at their mean. In the code block below, we will use the <code>MLMusingR</code> and <code>misty</code> package to mean and grand mean center our data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MLMusingR) <span class="co">#using for centering</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(misty) <span class="co">#used for grand mean centering</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Group Means for SES</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(classroom_id) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ses_grpmean =</span> <span class="fu">mean</span>(ses)) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Group mean centering SES</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ses_mc =</span> <span class="fu">group_center</span>(ses, classroom_id))</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ses_mc <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(data<span class="sc">$</span>ses_mc)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Grand mean centering Gender</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ses_gmc =</span> <span class="fu">center</span>(ses_grpmean, <span class="at">type =</span> <span class="st">"CGM"</span>, <span class="at">cluster =</span> classroom_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When mean centering our data within the context of HLM, our mean centered variable is the difference between the individual score and the group mean. For example, if a student’s SES score is 60 and the mean SES score for their classroom is 50, then the mean centered SES score for that student is 10.</p>
<p>When grand mean centering our data within the context of HLM, our grand mean centered variable is the difference between the group mean and the grand mean. For example, if the mean SES score for a classroom is 50 and the grand mean SES score for the entire sample is 45, then the grand mean centered SES score for that classroom is 5.</p>
<p>Here’s how your dataframe should look like up to this point:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  math_score intervention classroom_id student_id   ses ses_grpmean ses_mc
       &lt;dbl&gt;        &lt;dbl&gt;        &lt;int&gt;      &lt;int&gt; &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;
1       44.4            0            1          1  42.1        49.8  -7.65
2       47.7            0            1          2  45.0        49.8  -4.79
3       65.6            0            1          3  65.0        49.8  15.2 
4       50.7            0            1          4  38.6        49.8 -11.1 
5       51.3            0            1          5  48.2        49.8  -1.56
6       67.2            0            1          6  69.0        49.8  19.3 
# ℹ 1 more variable: ses_gmc &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="running-our-model" class="level2">
<h2 class="anchored" data-anchor-id="running-our-model">Running our Model</h2>
<p>Now that we have explored our data and centered our variables, we are ready to run our HLM model. In the code block below, we will use the <code>lme4</code> package to run our models. The <code>lme4</code> package is a powerful tool that allows us to run mixed effects models and has a similar syntax to the <code>lm</code> function. The <code>lmerTest</code> package is an extension of the <code>lme4</code> package and allows us to run significance tests for our models.</p>
<section id="null-model" class="level3">
<h3 class="anchored" data-anchor-id="null-model">Null Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load lme4 package</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run null model</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(math_score <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom_id), <span class="at">data =</span> data)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(null_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: math_score ~ 1 + (1 | classroom_id)
   Data: data

REML criterion at convergence: 1687

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.91013 -0.69522 -0.07367  0.58727  2.86313 

Random effects:
 Groups       Name        Variance Std.Dev.
 classroom_id (Intercept)  5.987   2.447   
 Residual                 63.379   7.961   
Number of obs: 240, groups:  classroom_id, 12

Fixed effects:
            Estimate Std. Error      df t value Pr(&gt;|t|)    
(Intercept)  52.4855     0.8735 11.0000   60.09 3.36e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>In this model, we are predicting math scores using a random intercept for classroom. The random intercept for classroom is represented by <code>(1 | classroom_id)</code>. The <code>1</code> represents the intercept and the <code>classroom_id</code> represents the groups.</p>
<p>Now, let’s run our full model. We want to see if the intervention has an effect on math scores while controlling for SES. We also want to see if the intervention has a different effect on math scores for students with low SES compared to students with high SES. We will allow the intervention vary across classrooms.</p>
</section>
<section id="full-model" class="level3">
<h3 class="anchored" data-anchor-id="full-model">Full Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run full model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(math_score <span class="sc">~</span> intervention <span class="sc">+</span> ses <span class="sc">+</span> intervention<span class="sc">*</span>ses <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> intervention <span class="sc">|</span> classroom_id), <span class="at">data =</span> data)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: 
math_score ~ intervention + ses + intervention * ses + (1 + intervention |  
    classroom_id)
   Data: data

REML criterion at convergence: 1685.7

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-2.88198 -0.65425 -0.08606  0.59275  2.80765 

Random effects:
 Groups       Name         Variance Std.Dev. Corr
 classroom_id (Intercept)   3.477   1.865        
              intervention  3.199   1.789    0.56
 Residual                  62.655   7.915        
Number of obs: 240, groups:  classroom_id, 12

Fixed effects:
                  Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)       61.07409    4.08533 198.58309  14.950   &lt;2e-16 ***
intervention      -9.71573    5.46709 201.25036  -1.777   0.0771 .  
ses               -0.15977    0.07602 230.57755  -2.102   0.0367 *  
intervention:ses   0.17658    0.10097 229.31073   1.749   0.0816 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) intrvn ses   
interventin -0.747              
ses         -0.966  0.722       
intrvntn:ss  0.728 -0.942 -0.753</code></pre>
</div>
</div>
<p>In this model, we are predicting math scores using intervention, SES, and the interaction between intervention and SES. We are also allowing the intercept and intervention to vary across classrooms. The random intercept and intervention for classroom is represented by <code>(1 + intervention | classroom_id)</code>.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>